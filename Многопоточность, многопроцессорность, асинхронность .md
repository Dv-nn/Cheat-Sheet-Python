## Многопоточность, многопроцессорность, асинхронность 
____
**Процессы** являются контейнерами. Их основная задача – изолировать программы друг от друга, чтобы одна не могла получить доступ к памяти другой.

**Многопроцессность (Multiprocessing)** чаще всего относится к эффекту параллельности и означает распределение задач между частями центральной
 вычислительной системы (процессорами или ядрами).

**Многопоточность -** это модель, при которой задача разбивается на множество потоков, занимающихся её решением. 
Один процесс может содержать множество потоков. Самое важное, что стоит знать о многопоточности —
она прекрасно решает задачи связанные с вводом/выводом (I/O) информации.

**Асинхронная модель** - это неблокирующее выполнение между функциями, асинхронные подпрограммы способны вставать на паузу, 
ожидая получение какого-то результата и давая работать другим подпрограммам.
____
### Что такое GIL?

В Python используется глобальная блокировка интерпретатора (Global Interpreter Lock — GIL), 
накладывающая некоторые ограничения на потоки.
Блокировка, позволяет только одному потоку управлять интерпретатором Python. Это означает, 
что в любой момент времени будет выполняться только один конкретный поток. Из этого следует, 
что с потоками невозможно использовать несколько ядер процессора.
GIL был введен в Python потому, что управление памятью CPython не является потокобезопасным. 
Имея такую блокировку Python может быть уверен, что никогда не будет условий гонки. 

Во многопоточных программах отсутствие GIL может негативно сказываться на производительности процессоро-зависымых программ.

Python подсчитывает количество ссылок для корректного управления памятью. Это означает,
что созданные в Python объекты имеют переменную подсчёта ссылок, в которой хранится количество всех ссылок на этот объект. 
Как только эта переменная становится равной нулю, память, выделенная под этот объект, освобождается.
____  
### Многопоточные и многопроцессорные программы в python

Параллелизм дает возможность работать над несколькими вычислениями одновременно в одной программе. Такого поведения в Python можно добиться несколькими способами:
- Используя несколько ядер процессора `multiprocessing`. Делать сразу несколько вычислений, используя несколько ядер процессора. Это и называется параллелизмом.
    +Process: Класс для создания и управления процессами. Позволяет запускать функции в новом процессе  
    +Pool: Класс, предоставляющий пул процессов для выполнения задач параллельно. Позволяет управлять пулом процессов и распределять задачи между процессами  
    +Queue: Класс для обмена данными между процессами через очередь, обеспечивая безопасность при работе с разделяемыми данными  
    +Manager: Класс для управления разделяемыми объектами между процессами. Позволяет создавать разделяемые списки, словари, очереди и другие  
    +Lock, Event, Condition, Semaphore: Классы для синхронизации процессов и предотвращения состязаний (race conditions) при доступе к общим ресурсам  
    +Pipe: Механизм для обмена данными между двумя процессами через двусторонний канал  
    +cpu_count(): Функция для возвращения количества доступных в системе процессоров (ядер)
  
- Используя многопоточность `threading`, позволяя нескольким потокам работать по очереди
     +Thread: Класс для создания и управления потоками выполнения. Позволяет запускать функции в новом потоке  
     +Lock, Event, Condition, Semaphore: Классы для синхронизации потоков и предотвращения состязаний (race conditions) при доступе к общим ресурсам  
     +Timer: Класс для выполнения функции через определенное время  
     +Barrier: Класс для организации точек синхронизации, где потоки могут остановиться и дождаться друг друга  
     +local: Класс для хранения данных в потоке-локальном хранилище, доступном только в рамках данного потока  
     +enumerate(): Функция для получения списка всех активных потоков в программе  
     +current_thread(): Функция для получения объекта текущего исполняющегося потока  
    
- Используя асинхронный ввод-вывод с модулем `asyncio`. Запуская какую то задачу, продолжать делать другие вычисления, вместо ожидания ответа от сетевого подключения или от операций чтения/записи.

### Разница между потоками и процессами

Поток `threading` - это независимая последовательность выполнения каких то вычислений. Поток `thread` делит выделенную память ядру процессора, а так же его процессорное время со всеми другими потоками, которые создаются программой в рамках одного ядра процессора. Программы на языке Python имеют, по умолчанию, один основной поток. Можно создать их больше и позволить Python переключаться между ними. Это переключение происходит очень быстро и кажется, что они работают параллельно.

Понятие процесс в `multiprocessing` - представляет собой так же независимую последовательность выполнения вычислений. В отличие от потоков threading, процесс имеет собственное ядро и следовательно выделенную ему память, которое не используется совместно с другими процессами. Процесс может клонировать себя, создавая два или более экземпляра в одном ядре процессора.

Асинхронный ввод-вывод не является ни потоковым (`threading`), ни многопроцессорным (`multiprocessing`). По сути, это однопоточная, однопроцессная парадигма и не относится к параллельным вычислениям.

### Что такое условия гонки и потокобезопасность?

- Состояние гонки возникает, когда несколько потоков могут одновременно получать доступ к общей структуре данных или местоположению в памяти и изменять их, в следствии чего могут произойти непредсказуемые вещи.
    
    Если два пользователя одновременно редактируют один и тот же документ онлайн и второй пользователь сохранит данные в базу, то перезапишет работу первого пользователя. Чтобы избежать условий гонки, необходимо заставить второго пользователя ждать, пока первый закончит работу с документом и только после этого разрешить второму пользователю открыть и начать редактировать документ.
    
- Потокобезопасность работает путем создания копии локального хранилища в каждом потоке, чтобы данные не сталкивались с другим потоком.

### Алгоритм планирования доступа потоков к общим данным

Потоки используют одну и ту же выделенную память. Когда несколько потоков работают одновременно, то нельзя угадать порядок, в котором потоки будут обращаются к общим данным. Результат доступа к совместно используемым данным зависит от алгоритма планирования. который решает, какой поток и когда запускать. Если такого алгоритма нет, то конечные данные могут быть не такими как ожидаешь

### Асинхронная модель

позволяет нескольким вещам происходить одновременно. Когда ваша программа вызывает длительно выполняющуюся функцию, она не блокирует поток выполнения
, и ваша программа продолжает выполняться. Когда функция завершается, программа знает и получает доступ к результату (если в этом есть необходимость).

- **async/await -** два ключевых слова в Python, которые используются, чтобы взаимодействовать с корутинами (coroutines)
- **asyncio -** Python библиотека которая обладает основными инструментами и API, чтобы запускать и управлять корутинами
- **aiohttp** - для асинхронной работы с запросами,
- **aiofiles** - для работы с файловой системой.
